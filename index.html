/* ===========================
   CONFIG: EMAILJS
   =========================== */
const EMAILJS_CONFIG = {
  PUBLIC_KEY: "YOUR_PUBLIC_KEY_HERE",
  SERVICE_ID: "YOUR_SERVICE_ID_HERE",
  TEMPLATE_ID: "YOUR_TEMPLATE_ID_HERE",
};

/* ===========================
   TRANSLATIONS (shortened sample)
   Add more keys as needed
   =========================== */
const translations = {
  en: {
    mainTitle: "Community Engagement Program",
    subtitle:
      "A supportive weekday program where adults with disabilities build friendships, explore new interests, and connect with their community.",
    btnPrimary: "Learn How to Join",
    btnSecondary: "View Our Location",
    aboutTitle: "About the Community Engagement Program",
    communitiesTitle: "Communities We Serve",
    contactTitle: "Ready to Learn More?",
  },
  es: {
    mainTitle: "Programa de Participación Comunitaria",
    subtitle:
      "Un programa de apoyo entre semana donde adultos con discapacidades construyen amistades, exploran nuevos intereses y se conectan con su comunidad.",
    btnPrimary: "Cómo Participar",
    btnSecondary: "Ver Nuestra Ubicación",
    aboutTitle: "Acerca del Programa de Participación Comunitaria",
    communitiesTitle: "Comunidades Que Servimos",
    contactTitle: "¿Listo Para Saber Más?",
  },
};

let currentLang = "en";

/* ===========================
   HELPERS
   =========================== */
function qs(selector) {
  return document.querySelector(selector);
}

function setText(id, value) {
  const el = document.getElementById(id);
  if (el) el.textContent = value;
}

function openModal() {
  const modal = qs("#modal");
  modal.classList.add("active");
  modal.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
  qs("#firstName")?.focus();
}

function closeModal() {
  const modal = qs("#modal");
  modal.classList.remove("active");
  modal.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
}

/* ===========================
   LANGUAGE
   =========================== */
function applyLanguage(lang) {
  const t = translations[lang];
  if (!t) return;

  setText("tMainTitle", t.mainTitle);
  setText("tSubtitle", t.subtitle);
  setText("btnOpenModal", t.btnPrimary);
  setText("btnScrollCommunities", t.btnSecondary);
  setText("tAboutTitle", t.aboutTitle);
  setText("tCommunitiesTitle", t.communitiesTitle);
  setText("tContactTitle", t.contactTitle);

  // Toggle UI state
  qs("#langEn").classList.toggle("active", lang === "en");
  qs("#langEs").classList.toggle("active", lang === "es");
  qs("#langToggle").classList.toggle("active", lang === "es");
}

/* ===========================
   EMAILJS INIT + SUBMIT
   =========================== */
function initEmailJs() {
  if (typeof emailjs === "undefined") return;

  const { PUBLIC_KEY } = EMAILJS_CONFIG;
  if (!PUBLIC_KEY || PUBLIC_KEY.includes("YOUR_PUBLIC_KEY")) return;

  emailjs.init(PUBLIC_KEY);
}

async function handleSubmit(e) {
  e.preventDefault();

  const submitBtn = qs("#submitBtn");
  submitBtn.disabled = true;
  submitBtn.textContent = currentLang === "en" ? "Sending..." : "Enviando...";

  const notConfigured =
    EMAILJS_CONFIG.PUBLIC_KEY.includes("YOUR_PUBLIC_KEY") ||
    EMAILJS_CONFIG.SERVICE_ID.includes("YOUR_SERVICE_ID") ||
    EMAILJS_CONFIG.TEMPLATE_ID.includes("YOUR_TEMPLATE_ID");

  if (notConfigured) {
    alert(
      currentLang === "en"
        ? "EmailJS is not configured yet. Add your keys in script.js."
        : "EmailJS no está configurado. Agregue sus claves en script.js."
    );
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit";
    return;
  }

  const formData = {
    from_name: `${qs("#firstName").value} ${qs("#lastName").value}`,
    firstName: qs("#firstName").value,
    lastName: qs("#lastName").value,
    contactType: qs("#contactType").value,
    reply_to: qs("#email").value,
    email: qs("#email").value,
    phone: qs("#phone").value,
    city: qs("#city").value,
    zip: qs("#zip").value,
    referral: qs("#referral").value,
    message: qs("#details").value,
  };

  try {
    await emailjs.send(
      EMAILJS_CONFIG.SERVICE_ID,
      EMAILJS_CONFIG.TEMPLATE_ID,
      formData
    );

    alert(
      currentLang === "en"
        ? "Message sent! We will follow up soon."
        : "¡Mensaje enviado! Nos pondremos en contacto pronto."
    );

    qs("#contactForm").reset();
    closeModal();
  } catch (err) {
    console.error(err);
    alert(
      currentLang === "en"
        ? "Something went wrong. Please email referrals@optionsforall.org."
        : "Algo salió mal. Envíe un correo a referrals@optionsforall.org."
    );
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit";
  }
}

/* ===========================
   EVENTS
   =========================== */
document.addEventListener("DOMContentLoaded", () => {
  initEmailJs();
  applyLanguage(currentLang);

  // Modal open buttons
  qs("#btnOpenModal")?.addEventListener("click", openModal);
  qs("#btnOpenModal2")?.addEventListener("click", openModal);

  // Modal close
  qs("#btnCloseModal")?.addEventListener("click", closeModal);
  qs("#modal")?.addEventListener("click", (e) => {
    if (e.target.id === "modal") closeModal();
  });
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeModal();
  });

  // Scroll
  qs("#btnScrollCommunities")?.addEventListener("click", () => {
    qs("#communitiesSection")?.scrollIntoView({ behavior: "smooth", block: "start" });
  });

  // Language toggle
  qs("#langToggle")?.addEventListener("click", () => {
    currentLang = currentLang === "en" ? "es" : "en";
    applyLanguage(currentLang);
  });
  qs("#langEn")?.addEventListener("click", () => {
    currentLang = "en";
    applyLanguage(currentLang);
  });
  qs("#langEs")?.addEventListener("click", () => {
    currentLang = "es";
    applyLanguage(currentLang);
  });

  // Form submit
  qs("#contactForm")?.addEventListener("submit", handleSubmit);
});

